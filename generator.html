<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Generator</title>
    <style>
        :root { --bg: #020617; --sidebar: #0f172a; --text: #f8fafc; --accent: #22d3ee; }
        body { margin: 0; font-family: sans-serif; background: black; color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        aside { width: 260px; background: var(--sidebar); border-right: 1px solid #1e293b; padding: 20px; }
        .nav-item { display: flex; align-items: center; padding: 12px 15px; color: #94a3b8; text-decoration: none; margin-bottom: 5px; }
        .nav-item.active { color: var(--accent); }
        
        .content { flex: 1; display: flex; }
        .controls { width: 350px; background: #0f172a; padding: 30px; border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .preview { flex: 1; display: flex; align-items: center; justify-content: center; background-image: radial-gradient(#334155 1px, transparent 1px); background-size: 20px 20px; }
        
        textarea { width: 100%; height: 150px; background: #020617; border: 1px solid #334155; color: white; padding: 15px; border-radius: 10px; resize: none; margin-bottom: 20px; box-sizing: border-box; }
        .btn-gen { width: 100%; padding: 15px; background: #ef4444; color: white; border: none; font-weight: 900; border-radius: 10px; cursor: pointer; font-size: 1.1rem; }
        .btn-gen:hover { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
    </style>
</head>
<body>
    <aside>
        <div style="font-size: 1.5rem; font-weight: 900; margin-bottom: 40px;">METAFORGE</div>
        <a href="dashboard.html" class="nav-item">üìä Dashboard</a>
        <a href="library.html" class="nav-item">üì¶ Library</a>
        <a href="generator.html" class="nav-item active">‚ö° Generator</a>
        <a href="community.html" class="nav-item">üåê Community</a>
    </aside>
    
    <div class="content">
        <div class="controls">
            <h2 style="margin-top: 0;">System Ready</h2>
            <label style="font-size: 0.8rem; color: var(--accent); display: block; margin-bottom: 10px;">1. TEXT PROMPT</label>
            <textarea id="prompt" placeholder="Describe your asset..."></textarea>
            
            <label style="font-size: 0.8rem; color: var(--accent); display: block; margin-bottom: 10px;">2. UPLOAD REF (OPTIONAL)</label>
            <input type="file" id="file" style="margin-bottom: 30px; color: #94a3b8;">
            
            <button class="btn-gen" id="gen-btn">INITIALIZE</button>
            <div id="status" style="text-align: center; margin-top: 10px; font-family: monospace; color: #eab308; display: none;">>> PROCESSING...</div>
        </div>
        <div class="preview" id="preview">
            <div style="text-align: center; color: #64748b;">Awaiting Input...</div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://postumbilical-amiee-mystifiedly.ngrok-free.dev/api/v1';
        document.getElementById('gen-btn').addEventListener('click', async () => {
            const token = localStorage.getItem('access_token');
            const status = document.getElementById('status');
            status.style.display = 'block';
            
            const fd = new FormData();
            if(document.getElementById('file').files[0]) fd.append('file', document.getElementById('file').files[0]);
            else fd.append('file', new Blob([document.getElementById('prompt').value], {type:'text/plain'}), 'prompt.txt');
            
            try {
                const res = await fetch(`${API_BASE_URL}/assets/generate`, { method:'POST', headers:{'Authorization':`Bearer ${token}`}, body:fd });
                if(res.ok) {
                    const d = await res.json();
                    status.innerText = ">> STARTED.";
                    document.getElementById('preview').innerHTML = `<div style='color:#4ade80; font-weight:bold;'>Task Started: ${d.id}<br><a href='library.html' style='color:white;'>View Library</a></div>`;
                } else { alert("Error/Limit Reached"); status.style.display='none'; }
            } catch(e) { alert("Conn Error"); }
        });
    </script>
</body>
</html>